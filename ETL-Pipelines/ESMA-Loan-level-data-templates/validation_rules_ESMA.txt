import datetime


TO_NUMBER = lambda n: float(n)


def TO_DATE(s):
    # Check number of hypens to understand formatting: 0 >> just year, 1 >> year-month, 2 >> year-month-day
    if s.count("-") == 2:
        return datetime.datetime.strptime(s, "%Y-%m-%d")
    if s.count("-") == 1:
        return datetime.datetime.strptime(s, "%Y-%m")
    if s.count("-") == 0:
        return datetime.datetime.strptime(s, "%Y")


def asset_schema():
    """
    Return validation schema for ASSETS data type.
    """
    schema = {
        "AUTL1": {
            "type": "string",
            "maxlength": 28,
            "meta": {"label": "Unique Identifier"},
        },
        "AUTL2": {
            "type": "string",
            "maxlength": 1000,
            "meta": {"label": "Original Underlying Exposure Identifier"},
        },
        "AUTL3": {
            "type": "string",
            "maxlength": 1000,
            "meta": {"label": "New Underlying Exposure Identifier"},
        },
        "AUTL4": {
            "type": "string",
            "maxlength": 1000,
            "meta": {"label": "Original Obligor Identifier"},
        },
        "AUTL5": {
            "type": "string",
            "maxlength": 1000,
            "meta": {"label": "New Obligor Identifier"},
        },
        "AUTL6": {
            "type": "datetime",
            "coerce": "to_date",
            "meta": {"label": "Data Cut-Off Date"},
        },
        "AUTL7": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Pool Addition Date"},
        },
        "AUTL8": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Date Of Repurchase"},
        },
        "AUTL9": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Redemption Date"},
        },
        "AUTL10": {
            "type": "string",
            "nullable": True,
            "meta": {"label": "Geographic Region - Obligor"},
        },
        "AUTL11": {
            "type": "string",
            "regex": r"^\d{4}$",
            "nullable": True,
            "meta": {"label": "Geographic Region Classification"},
        },
        "AUTL12": {
            "type": "string",
            "allowed": ["EMRS", "EMBL", "EMUK", "UNEM", "SFEM", "NOEM", "STNT", "PNNR", "OTHR"],
            "nullable": True,
            "meta": {"label": "Employment Status"},
        },
        "AUTL13": {
            "type": "string",
            "allowed": ["Y", "N"],
            "nullable": True,
            "meta": {"label": "Credit Impaired Obligor"},
        },
        "AUTL14": {
            "type": "string",
            "allowed": ["PUBL", "LLCO", "PNTR", "INDV", "GOVT", "OTHR"],
            "nullable": True,
            "meta": {"label": "Obligor Legal Type"},
        },
        "AUTL15": {
            "type": "string",
            "allowed": ["CNEO", "CEMO", "CNRO", "ENEO", "EEMO", "ENRO", "OTHR"],
            "nullable": True,
            "meta": {"label": "Customer Type"},
        },
        "AUTL16": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Primary Income"},
        },
        "AUTL17": {
            "type": "string",
            "allowed": ["GRAN", "NITS", "NITX", "NTIN", "ENIS", "EITX", "EISS", "DSPL", "CORP", "OTHR"],
            "nullable": True,
            "meta": {"label": "Primary Income Type"},
        },
        "AUTL18": {
            "type": "string",
            "regex": r"^[A-Z]{3}$",
            "nullable": True,
            "meta": {"label": "Primary Income Currency"},
        },
        "AUTL19": {
            "type": "string",
            "allowed": ["SCRT", "SCNF", "VRFD", "NVRF", "SCRG", "OTHR"],
            "nullable": True,
            "meta": {"label": "Primary Income Verification"},
        },
        "AUTL20": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Revenue"},
        },
        "AUTL21": {
            "type": "string",
            "regex": r"^[A-Z]{3}$",
            "nullable": True,
            "meta": {"label": "Financial Statement Currency"},
        },
        "AUTL22": {
            "type": "string",
            "maxlength": 10000,
            "nullable": True,
            "meta": {"label": "Special Scheme"},
        },
        "AUTL23": {
            "type": "string",
            "allowed": ["PPUR", "PHIR", "HIRP", "LEAP", "FNLS", "OPLS", "OTHR"],
            "nullable": True,
            "meta": {"label": "Product Type"},
        },
        "AUTL24": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Origination Date"},
        },
        "AUTL25": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Maturity Date"},
        },
        "AUTL26": {
            "type": "integer",
            "coerce": "to_int",
            "min": 0,
            "max": 9999,
            "nullable": True,
            "meta": {"label": "Original Term"},
        },
        "AUTL27": {
            "type": "string",
            "allowed": ["ADLR", "BROK", "DIRE", "IDRT", "OTHR"],
            "nullable": True,
            "meta": {"label": "Origination Channel"},
        },
        "AUTL28": {
            "type": "string",
            "regex": r"^[A-Z]{3}$",
            "meta": {"label": "Currency Denomination"},
        },
        "AUTL29": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Original Principal Balance"},
        },
        "AUTL30": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Current Principal Balance"},
        },
        "AUTL31": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Purchase Price"},
        },
        "AUTL32": {
            "type": "string",
            "allowed": ["FRXX", "DEXX", "FIXE", "BLLT", "OTHR"],
            "nullable": True,
            "meta": {"label": "Amortisation Type"},
        },
        "AUTL33": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Principal Grace Period End Date"},
        },
        "AUTL34": {
            "type": "string",
            "allowed": ["MNTH", "QUTR", "SEMI", "YEAR", "OTHR"],
            "nullable": True,
            "meta": {"label": "Scheduled Principal Payment Frequency"},
        },
        "AUTL35": {
            "type": "string",
            "allowed": ["MNTH", "QUTR", "SEMI", "YEAR", "OTHR"],
            "nullable": True,
            "meta": {"label": "Scheduled Interest Payment Frequency"},
        },
        "AUTL36": {
            "type": "string",
            "allowed": ["CDTX", "SORD", "CHKX", "CASH", "BTRA", "OTHR"],
            "nullable": True,
            "meta": {"label": "Payment Method"},
        },
        "AUTL37": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Payment Due"},
        },
        "AUTL38": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Balloon Amount"},
        },
        "AUTL39": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Down Payment Amount"},
        },
        "AUTL40": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Current Interest Rate"},
        },
        "AUTL41": {
            "type": "string",
            "allowed": ["MAAA", "FUSW", "LIBI", "LIBO", "SWAP", "TREA", "EURI", "PFAN", "EONA", 
                        "EONS", "EUUS", "EUCH", "TIBO", "ISDA", "GCFR", "STBO", "BBSW", "JIBA", 
                        "BUBO", "CDOR", "CIBO", "MOSP", "NIBO", "PRBO", "TLBO", "WIBO", "BOER", 
                        "ECBR", "LDOR", "OTHR"],
            "nullable": True,
            "meta": {"label": "Current Interest Rate Index"},
        },
        "AUTL42": {
            "type": "string",
            "allowed": ["OVNG", "INDA", "DAIL", "WEEK", "TOWK", "MNTH", "TOMN", "QUTR", "FOMN", 
                       "SEMI", "YEAR", "ONDE", "OTHR"],
            "nullable": True,
            "meta": {"label": "Current Interest Rate Index Tenor"},
        },
        "AUTL43": {
            "type": "number",
            "coerce": "to_number",
            "nullable": True,
            "meta": {"label": "Current Interest Rate Margin"},
        },
        "AUTL44": {
            "type": "integer",
            "coerce": "to_int",
            "min": 0,
            "max": 9999,
            "nullable": True,
            "meta": {"label": "Interest Rate Reset Interval"},
        },
        "AUTL45": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Interest Rate Cap"},
        },
        "AUTL46": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Interest Rate Floor"},
        },
        "AUTL47": {
            "type": "integer",
            "coerce": "to_int",
            "min": 0,
            "max": 9999,
            "nullable": True,
            "meta": {"label": "Number Of Payments Before Securitisation"},
        },
        "AUTL48": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "max": 100.0,
            "nullable": True,
            "meta": {"label": "Percentage Of Prepayments Allowed Per Year"},
        },
        "AUTL49": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Prepayment Fee"},
        },
        "AUTL50": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Prepayment Fee End Date"},
        },
        "AUTL51": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Prepayment Date"},
        },
        "AUTL52": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Cumulative Prepayments"},
        },
        "AUTL53": {
            "type": "string",
            "maxlength": 100,
            "nullable": True,
            "meta": {"label": "Manufacturer"},
        },
        "AUTL54": {
            "type": "string",
            "maxlength": 100,
            "nullable": True,
            "meta": {"label": "Model"},
        },
        "AUTL55": {
            "type": "string",
            "regex": r"^\d{4}$",
            "nullable": True,
            "meta": {"label": "Year Of Registration"},
        },
        "AUTL56": {
            "type": "string",
            "allowed": ["NEWX", "USED", "DEMO", "OTHR"],
            "nullable": True,
            "meta": {"label": "New Or Used"},
        },
        "AUTL57": {
            "type": "string",
            "allowed": ["EPCA", "EPCB", "EPCC", "EPCD", "EPCE", "EPCF", "EPCG", "OTHR"],
            "nullable": True,
            "meta": {"label": "Energy Performance Certificate Value"},
        },
        "AUTL58": {
            "type": "string",
            "maxlength": 100,
            "nullable": True,
            "meta": {"label": "Energy Performance Certificate Provider Name"},
        },
        "AUTL59": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "max": 100.0,
            "nullable": True,
            "meta": {"label": "Original Loan-To-Value"},
        },
        "AUTL60": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Original Valuation Amount"},
        },
        "AUTL61": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Original Residual Value Of Vehicle"},
        },
        "AUTL62": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Option To Buy Price"},
        },
        "AUTL63": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Securitised Residual Value"},
        },
        "AUTL64": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Updated Residual Value Of Vehicle"},
        },
        "AUTL65": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Date Of Updated Residual Valuation Of Vehicle"},
        },
        "AUTL66": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Date Of Restructuring"},
        },
        "AUTL67": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Date Last In Arrears"},
        },
        "AUTL68": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "meta": {"label": "Arrears Balance"},
        },
        "AUTL69": {
            "type": "integer",
            "coerce": "to_int",
            "min": 0,
            "max": 9999,
            "meta": {"label": "Number Of Days In Arrears"},
        },
        "AUTL70": {
            "type": "string",
            "allowed": ["PERF", "RNAR", "RARR", "DFLT", "NDFT", "DTCR", "DADB", "ARRE", 
                       "REBR", "REDF", "RERE", "RESS", "REOT", "RDMD", "OTHR"],
            "meta": {"label": "Account Status"},
        },
        "AUTL71": {
            "type": "string",
            "allowed": ["UPXX", "PDXX", "UPPD"],
            "nullable": True,
            "meta": {"label": "Reason for Default or Foreclosure"},
        },
        "AUTL72": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Default Amount"},
        },
        "AUTL73": {
            "type": "datetime",
            "coerce": "to_date",
            "nullable": True,
            "meta": {"label": "Default Date"},
        },
        "AUTL74": {
            "type": "number",
            "coerce": "to_number",
            "nullable": True,
            "meta": {"label": "Allocated Losses"},
        },
        "AUTL75": {
            "type": "number",
            "coerce": "to_number",
            "nullable": True,
            "meta": {"label": "Residual Value Losses"},
        },
        "AUTL76": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Cumulative Recoveries"},
        },
        "AUTL77": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Sale Price"},
        },
        "AUTL78": {
            "type": "number",
            "coerce": "to_number",
            "min": 0.0,
            "nullable": True,
            "meta": {"label": "Deposit Amount"},
        },
        "AUTL79": {
            "type": "string",
            "maxlength": 100,
            "nullable": True,
            "meta": {"label": "Original Lender Name"},
        },
        "AUTL80": {
            "type": "string",
            "regex": r"^[0-9A-Z]{20}$",
            "nullable": True,
            "meta": {"label": "Original Lender Legal Entity Identifier"},
        },
        "AUTL81": {
            "type": "string",
            "regex": r"^[A-Z]{2}$",
            "nullable": True,
            "meta": {"label": "Original Lender Establishment Country"},
        },
        "AUTL82": {
            "type": "string",
            "maxlength": 100,
            "meta": {"label": "Originator Name"},
        },
        "AUTL83": {
            "type": "string",
            "regex": r"^[0-9A-Z]{20}$",
            "meta": {"label": "Originator Legal Entity Identifier"},
        },
        "AUTL84": {
            "type": "string",
            "regex": r"^[A-Z]{2}$",
            "meta": {"label": "Originator Establishment Country"},
        },
    }

    return schema
